{"link_serial":109,"update_time":"2017-12-15T17:05:49.302000+00:00","scrub_version":"48f99abcdf450e7c49a04015355fb699f785e8cbf8288d894686a64c6caeddd1","instance_id":"23984b8f-60fb-4374-8c5c-45569204a0a6","update_user_id":"jskrable@bu.edu","phase_snode_id":null,"class_fqid":"com-snaplogic-pipeline_8","partition_snode_id":"5a1eba684503bf001e5a19c6","path_id":"/BUDev/Admin-Integration-Services/shared","create_time":"2017-12-15T16:00:52.412000+00:00","snode_id":"5a33f1b42cf68b001e7c81a9","snap_map":{"43407e04-36b0-4495-ad54-21f82a3ed339":{"instance_id":"43407e04-36b0-4495-ad54-21f82a3ed339","class_id":"com-snaplogic-snaps-script-script","class_build_tag":"snapsmrc298","class_fqid":"com-snaplogic-snaps-script-script_2-snapsmrc298","instance_version":3,"property_map":{"info":{"notes":{"value":null},"label":{"value":"sleepFor5Minutes"}},"view_serial":102,"input":{"input102":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"editable_content":{"value":"# Import the interface required by the Script snap.\nfrom com.snaplogic.scripting.language import ScriptHook\nfrom time import sleep\n\nclass TransformScript(ScriptHook):\n    def __init__(self, input, output, error, log):\n        self.input = input\n        self.output = output\n        self.error = error\n        self.log = log\n\n    # The \"execute()\" method is called once when the pipeline is started\n    # and allowed to process its inputs or just send data to its outputs.\n    def execute(self):\n        self.log.info(\"Executing Transform script\")\n        while self.input.hasNext():\n            try:\n                # Read the next document, wrap it in a map and write out the wrapper\n                in_doc = self.input.next()\n                sleep(60*5)\n                self.output.write()\n            except Exception as e:\n                errWrapper = {\n                    'errMsg' : str(e.args)\n                }\n                self.log.error(\"Error in python script\")\n                self.error.write(errWrapper)\n            \n        self.log.info(\"Finished executing the Transform script\")\n        \n# The Script Snap will look for a ScriptHook object in the \"hook\"\n# variable.  The snap will then call the hook's \"execute\" method.\nhook = TransformScript(input, output, error, log)"},"language":{"value":"Python"},"executable_during_suggest":{"value":false},"script":{"expression":false,"value":null}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output101":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":2,"instance_fqid":"43407e04-36b0-4495-ad54-21f82a3ed339_3"},"2e2ba706-b5ef-4078-ad62-e813041c2373":{"instance_version":1,"class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc465","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc465","instance_id":"2e2ba706-b5ef-4078-ad62-e813041c2373","property_map":{"info":{"notes":{"value":"Maps the information returned from BioRAFT API in the event of HTTP error and restructures into a response."},"label":{"value":"mapErrorData"}},"view_serial":100,"input":{"input0":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"nullSafeAccess":{"value":true},"passThrough":{"value":false},"transformations":{"value":{"mappingTable":{"value":[{"targetPath":{"value":"$response.message"},"expression":{"expression":true,"value":"\"The SnapLogic request was successful, but BioRAFT's API has returned an error. Please see information below.\""}},{"targetPath":{"value":"$response.statusCode"},"expression":{"expression":true,"value":"$statusCode"}},{"targetPath":{"value":"$response.error"},"expression":{"expression":true,"value":"$error"}},{"targetPath":{"value":"$response.error_entity"},"expression":{"expression":true,"value":"$error_entity"}},{"targetPath":{"value":"$response.original"},"expression":{"expression":true,"value":"$original"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":4,"instance_fqid":"2e2ba706-b5ef-4078-ad62-e813041c2373_1"},"bcb0d710-9b21-42bf-8a41-422c397af45c":{"instance_version":1,"class_id":"com-snaplogic-snaps-rest-get","class_build_tag":"snapsmrc414","class_fqid":"com-snaplogic-snaps-rest-get_2-snapsmrc414","instance_id":"bcb0d710-9b21-42bf-8a41-422c397af45c","property_map":{"info":{"notes":{"value":"Performs a REST Get to the BioRAFT API service. Appended to the URL are both the request time (unix timestamp format) and the query string passed from the SnapLogic request."},"label":{"value":"getBioRAFTRESTData"}},"view_serial":100,"account":{"account_ref":{"expression":false,"value":{}}},"input":{"input0":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"retryInterval":{"value":3},"trustAllCerts":{"value":true},"retry":{"value":5},"hasNext":{"expression":true,"value":null},"timeout":{"value":900},"processArray":{"value":false},"nextUrl":{"expression":true,"value":null},"showAllHeaders":{"value":false},"paginationInterval":{"value":0},"executeDuringPreview":{"value":true},"header":{"value":[{"headerKey":{"expression":true,"value":"\"public_key\""},"headerValue":{"expression":true,"value":"$public_key"}},{"headerKey":{"expression":true,"value":"\"authentication_hash\""},"headerValue":{"expression":true,"value":"$authentication_hash"}}]},"responseEntityType":{"value":"DEFAULT"},"followRedirects":{"value":true},"serviceUrl":{"expression":true,"value":"\"http://bu.bioraft.com/v1/training/records?request_time=\" + $request_time + $query"},"connTimeout":{"value":30},"queryParams":{"value":[]},"rawData":{"value":false}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"continue"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"class_version":2,"instance_fqid":"bcb0d710-9b21-42bf-8a41-422c397af45c_1"},"18585d64-3cf6-459f-b08e-48537e0ae7bc":{"instance_version":2,"class_id":"com-snaplogic-snaps-binary-simpleread","class_build_tag":"snapsmrc465","class_fqid":"com-snaplogic-snaps-binary-simpleread_1-snapsmrc465","instance_id":"18585d64-3cf6-459f-b08e-48537e0ae7bc","property_map":{"info":{"notes":{"value":"Read from JSON file containing BioRAFT API request keys"},"label":{"value":"readAPIKeyJSONFile"}},"view_serial":101,"account":{"account_ref":{"expression":false,"value":{"ref_id":{"expression":false,"value":"0d98021d-436d-4e36-98ba-4031f2c082a5"},"ref_class_id":{"value":"com-snaplogic-snaps-binary-binarys3account"},"label":{"expression":false,"value":"AWS S3 Buckets prod"}}}},"input":{"input101":{"view_type":{"value":"document"},"label":{"value":"input0"}}},"settings":{"executeDuringPreview":{"value":true},"preventURLEncoding":{"value":false},"filePath":{"expression":false,"value":"s3:///buistintegration/Authentication Data/bio_raft_keys.json"}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"binary"},"label":{"value":"output0"}}}},"class_version":1,"instance_fqid":"18585d64-3cf6-459f-b08e-48537e0ae7bc_2"},"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59":{"instance_version":11,"class_id":"com-snaplogic-snaps-transform-datatransform","class_build_tag":"snapsmrc414","class_fqid":"com-snaplogic-snaps-transform-datatransform_4-snapsmrc414","instance_id":"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59","property_map":{"info":{"notes":{"value":"Creates the authentication hash required for the REST call.\n\nIt also parses the query string from the request and prepares it for the BioRAFT call."},"label":{"value":"mapRequestRequirements"}},"view_serial":103,"input":{"input103":{"label":{"value":"input0"},"view_type":{"value":"document"}}},"settings":{"nullSafeAccess":{"value":false},"passThrough":{"value":false},"transformations":{"value":{"mappingTable":{"value":[{"targetPath":{"value":"$request_time"},"expression":{"expression":true,"value":"Date.now().getTime().toString().substr(0,10)"}},{"targetPath":{"value":"$authentication_hash"},"expression":{"expression":true,"value":"Digest.sha256($PIN+$public_key+$private_key+Date.now().getTime().toString().substr(0,10))"}},{"targetPath":{"value":"$query"},"expression":{"expression":false,"value":"&external_user_id=sajal"}},{"targetPath":{"value":"$public_key"},"expression":{"expression":true,"value":"$public_key"}}]},"mappingRoot":{"value":"$"}}}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"label":{"value":"output0"},"view_type":{"value":"document"}}}},"class_version":4,"instance_fqid":"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59_11"},"9ff67a94-a48d-46dc-a6b6-7290c248870f":{"instance_id":"9ff67a94-a48d-46dc-a6b6-7290c248870f","class_id":"com-snaplogic-snaps-email-emailsender","class_build_tag":"snapsmrc405","class_fqid":"com-snaplogic-snaps-email-emailsender_2-snapsmrc405","instance_version":9,"property_map":{"info":{"notes":{"value":null},"label":{"value":"sendEmailAlert"}},"view_serial":104,"account":{"account_ref":{"expression":false,"value":{"label":{"expression":false,"value":"shared test SMTP"},"ref_class_id":{"value":"com-snaplogic-snaps-email-smtpaccount"},"ref_id":{"expression":false,"value":"a84ab9c5-1c0f-49ee-ad06-20e1d2d85a16"}}}},"settings":{"body":{"expression":true,"value":"\"There was an issue connecting to BioRAFT's API. Please see errors below:\n\n     Status Code: \" + $response.statusCode +\n\"\n\n     Error: \" + $response.error +\n\"\n\n     Error Entity: \" + $response.error_entity +\n\n\"\n\nThis message will repeat if connection issues persist.\""},"retries":{"value":3},"from":{"expression":false,"value":"monitoring@snaplogic.budev.com"},"attachments":{"value":[{"url":{"expression":false,"value":null}}]},"cc":{"expression":false,"value":null},"emailType":{"value":"Plain text"},"batchSize":{"value":100},"executable_during_suggest":{"value":true},"bcc":{"expression":false,"value":null},"to":{"expression":false,"value":"jskrable@bu.edu"},"tableDataPath":{"value":"$response"},"passThrough":{"value":false},"subject":{"expression":true,"value":"'API Health Check Errors'"}},"error":{"error0":{"label":{"value":"error0"},"view_type":{"value":"document"}},"error_behavior":{"value":"fail"}},"input":{"input101":{"view_type":{"value":"document"},"label":{"value":"input0"}}}},"class_version":2,"instance_fqid":"9ff67a94-a48d-46dc-a6b6-7290c248870f_9"},"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc":{"instance_version":1,"class_id":"com-snaplogic-snaps-transform-jsonparser","class_build_tag":"snapsmrc465","class_fqid":"com-snaplogic-snaps-transform-jsonparser_1-snapsmrc465","instance_id":"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc","property_map":{"info":{"notes":{"value":"Parses the binary data into a readable JSON file"},"label":{"value":"parseAPIKeyJSONFile"}},"view_serial":100,"input":{"input0":{"view_type":{"value":"binary"},"label":{"value":"input0"}}},"settings":{"allowNonStandardJson":{"value":true},"arrayElementsAsDocuments":{"value":true},"jsonFilterPath":{"value":null}},"error":{"error0":{"view_type":{"value":"document"},"label":{"value":"error0"}},"error_behavior":{"value":"fail"}},"output":{"output0":{"view_type":{"value":"document"},"label":{"value":"output0"}}}},"class_version":1,"instance_fqid":"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc_1"}},"org_snode_id":"58c70e0ea87b6d76b3470f3e","path":"/BUDev/Admin-Integration-Services/shared/checkBioRAFTHealth","instance_version":29,"migrate_version":"master-2517","scrub_backup":[],"create_user_id":"jskrable@bu.edu","project_snode_id":"5a1eba684503bf001e5a19c8","property_map":{"info":{"notes":{"value":null},"author":{"value":"jskrable@bu.edu"},"purpose":{"value":null},"pipeline_doc_uri":{"value":null},"label":{"value":"checkBioRAFTHealth"}},"input":{"43407e04-36b0-4495-ad54-21f82a3ed339_input102":{"label":{"value":"sleepFor5Minutes - input0"},"view_type":{"value":"document"}}},"settings":{"imports":{"value":[]},"error_param_table":{"value":[]},"error_pipeline":{"expression":false,"value":null},"param_table":{"value":[]}},"instance_version":28,"error":{"error_behavior":{"value":"none"}},"output":{"bcb0d710-9b21-42bf-8a41-422c397af45c_output0":{"label":{"value":"getBioRAFTRESTData - output0"},"view_type":{"value":"document"}}}},"render_map":{"pan_x_num":0,"default_snaplex":"58c70e13050186404b38dff2","scale_ratio":1,"detail_map":{"43407e04-36b0-4495-ad54-21f82a3ed339":{"grid_x_int":1,"rot_int":0,"grid_y_int":3,"rot_tail_int":0},"2e2ba706-b5ef-4078-ad62-e813041c2373":{"grid_x_int":6,"grid_y_int":2,"rot_tail_int":0,"output":{},"input":{},"rot_int":0},"bcb0d710-9b21-42bf-8a41-422c397af45c":{"grid_x_int":5,"error":{"error0":{"dx_int":0,"rot_int":0,"dy_int":-1}},"grid_y_int":3,"rot_tail_int":0,"input":{},"output":{},"rot_int":0},"18585d64-3cf6-459f-b08e-48537e0ae7bc":{"grid_x_int":2,"rot_int":0,"grid_y_int":3,"rot_tail_int":0},"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59":{"grid_x_int":4,"rot_int":0,"grid_y_int":3,"rot_tail_int":0},"9ff67a94-a48d-46dc-a6b6-7290c248870f":{"grid_x_int":7,"rot_int":0,"grid_y_int":2,"rot_tail_int":0},"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc":{"grid_x_int":3,"grid_y_int":3,"rot_tail_int":0,"output":{},"input":{},"rot_int":0}},"pan_y_num":0},"org_id":"58c70e0ea87b6d76b3470f3e","class_version":8,"class_id":"com-snaplogic-pipeline","instance_fqid":"23984b8f-60fb-4374-8c5c-45569204a0a6_29","link_map":{"link108":{"src_view_id":"output101","dst_view_id":"input101","src_id":"43407e04-36b0-4495-ad54-21f82a3ed339","dst_id":"18585d64-3cf6-459f-b08e-48537e0ae7bc"},"link106":{"src_view_id":"output0","dst_view_id":"input103","src_id":"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc","dst_id":"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59"},"link107":{"src_view_id":"output0","dst_view_id":"input101","src_id":"2e2ba706-b5ef-4078-ad62-e813041c2373","dst_id":"9ff67a94-a48d-46dc-a6b6-7290c248870f"},"link105":{"src_view_id":"error0","dst_view_id":"input0","src_id":"bcb0d710-9b21-42bf-8a41-422c397af45c","dst_id":"2e2ba706-b5ef-4078-ad62-e813041c2373"},"link103":{"src_view_id":"output0","dst_view_id":"input0","src_id":"d61dc909-ecee-4fdf-b8e6-e3d7f2164d59","dst_id":"bcb0d710-9b21-42bf-8a41-422c397af45c"},"link101":{"src_view_id":"output0","dst_view_id":"input0","src_id":"18585d64-3cf6-459f-b08e-48537e0ae7bc","dst_id":"51110ad4-b0d2-4d2e-abd8-cb62eabee3fc"}},"original":{"partition_snode_id":"5a1eba684503bf001e5a19c6","updated_by":"jskrable@bu.edu","perms":["A","R","W","X"],"time_created":"2017-12-15T16:00:52.444000+00:00","snode_id":"5a33f1b42cf68b001e7c81a9","owner":"jskrable@bu.edu","path":"/BUDev/Admin-Integration-Services/shared/checkBioRAFTHealth","asset_type":"Pipeline","asset_id":"23984b8f-60fb-4374-8c5c-45569204a0a6","time_updated":"2017-12-15T17:05:49.302000+00:00","name":"checkBioRAFTHealth","parent_snode_id":"5a1eba684503bf001e5a19c8","acl":[],"metadata":{},"original":{"partition_snode_id":"5a1eba684503bf001e5a19c6","updated_by":"sdelano@bu.edu","perms":["A","R","W","X"],"time_created":"2017-11-29T13:47:20.754000+00:00","snode_id":"5a1eba684503bf001e5a19c8","owner":"sdelano@bu.edu","path":"/BUDev/Admin-Integration-Services/shared","asset_type":"Dir","asset_id":null,"time_updated":"2017-11-29T13:47:20.754000+00:00","name":"shared","parent_snode_id":"5a1eba684503bf001e5a19c6","acl":[{"perms":["R","W","X"],"subject_type":"USER","inherit":true,"subject":"sdelano@bu.edu"}],"metadata":{},"original":{"partition_snode_id":"5a1eba684503bf001e5a19c6","updated_by":"sdelano@bu.edu","perms":["A","R","W","X"],"time_created":"2017-11-29T13:47:20.711000+00:00","snode_id":"5a1eba684503bf001e5a19c6","owner":"sdelano@bu.edu","path":"/BUDev/Admin-Integration-Services","asset_type":"Dir","asset_id":null,"time_updated":"2017-11-29T13:47:20.711000+00:00","name":"Admin-Integration-Services","parent_snode_id":"58c70e0ea87b6d76b3470f3e","acl":[{"perms":["R","W","X"],"subject_type":"USER","inherit":true,"subject":"sdelano@bu.edu"}],"metadata":{}}}}}